(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[199],{4842:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});var a=s(7876),l=s(4232),n=s(8230),r=s.n(n),i=s(1922),o=s(7704),d=s(9149);function c(e){let{children:t}=e,[s,n]=(0,l.useState)(!1),[c,u]=(0,l.useState)(!1),m=(0,l.useRef)(null),{token:x,setToken:h}=(0,l.useContext)(d.AuthContext);return((0,l.useEffect)(()=>{n(!0);let e=e=>{m.current&&!m.current.contains(e.target)&&u(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),s)?(0,a.jsxs)("div",{children:[(0,a.jsx)("nav",{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg fixed top-0 left-0 w-full z-50",children:(0,a.jsxs)("div",{className:"container mx-auto flex justify-between items-center p-4",children:[(0,a.jsxs)("div",{className:"flex space-x-6",children:[(0,a.jsx)(r(),{href:"/",className:"text-lg font-semibold px-3 py-2 rounded hover:bg-white hover:bg-opacity-20 transition duration-300 ease-in-out",children:"Home"}),(0,a.jsx)(r(),{href:"/reports",className:"text-lg font-semibold px-3 py-2 rounded hover:bg-white hover:bg-opacity-20 transition duration-300 ease-in-out",children:"Reports"}),(0,a.jsx)(r(),{href:"/tools",className:"text-lg font-semibold px-3 py-2 rounded hover:bg-white hover:bg-opacity-20 transition duration-300 ease-in-out",children:"Tools"})]}),(0,a.jsx)("div",{className:"relative",ref:m,children:x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>u(!c),"aria-expanded":c,className:"flex items-center space-x-2 px-3 py-2 rounded hover:bg-purple-200 transition duration-300 ease-in-out",children:(0,a.jsx)(i.A,{className:"h-6 w-6 text-white"})}),c&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white text-gray-800 rounded-lg shadow-lg",role:"menu",children:[(0,a.jsx)("div",{className:"px-4 py-2 border-b",children:(0,a.jsx)("p",{className:"text-sm font-semibold text-gray-700",children:"Logged in"})}),(0,a.jsx)(r(),{href:"/settings",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-purple-200 rounded transition duration-200",role:"menuitem",children:"Settings"}),(0,a.jsx)("button",{onClick:()=>{h(null),localStorage.removeItem("authToken")},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 bg-white hover:bg-purple-200 rounded transition duration-200 focus:outline-none",role:"menuitem",children:(0,a.jsx)("b",{children:"Logout"})})]})]}):(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(r(),{href:"/",className:"flex items-center space-x-2 px-3 py-2 rounded hover:bg-purple-200 transition duration-300 ease-in-out",children:[(0,a.jsx)(o.A,{className:"h-6 w-6 text-white"}),(0,a.jsx)("span",{className:"text-sm font-semibold",children:"Login"})]})})})]})}),(0,a.jsx)("main",{className:"sm:px-0 lg:px-6 pt-8 w-full",children:t})]}):null}},8034:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings",function(){return s(9369)}])},9369:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var a=s(7876),l=s(4232),n=s(4842),r=s(9149);let i=()=>{let{token:e}=(0,l.useContext)(r.AuthContext),[t,s]=(0,l.useState)("Me"),[i,o]=(0,l.useState)(""),[d,c]=(0,l.useState)(""),[u,m]=(0,l.useState)([]),[x,h]=(0,l.useState)(null),[p,b]=(0,l.useState)(""),[g,N]=(0,l.useState)(""),[j,f]=(0,l.useState)("");(0,l.useEffect)(()=>{e&&fetch("/api/user-settings?token=".concat(encodeURIComponent(e))).then(e=>e.json()).then(e=>{e.defaultUser&&(s(e.defaultUser.name||"Me"),o(e.defaultUser.nightscout_address||""),c(e.defaultUser.nightscout_api_secret||"")),e.people&&m(e.people)})},[e]);let y=async()=>{e&&(await fetch("/api/user-settings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({defaultName:t,nightscoutAddress:i,nightscoutApiSecret:d})}),alert("Default user updated!"))},v=async t=>{e&&await fetch("/api/user-settings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({people:t})})},w=async e=>{if(e.preventDefault(),!p.trim()||!g.trim())return;let t=[...u];null!==x?t[x]={name:p.trim(),nightscout_address:g.trim(),nightscout_api_secret:j.trim()}:t.push({name:p.trim(),nightscout_address:g.trim(),nightscout_api_secret:j.trim()}),m(t),await v(t),b(""),N(""),f(""),h(null)},_=e=>{h(e),b(u[e].name),N(u[e].nightscout_address),f(u[e].nightscout_api_secret||"")},S=async e=>{let t=u.filter((t,s)=>s!==e);m(t),await v(t),x===e&&(h(null),b(""),N(""),f(""))};return e?(0,a.jsx)(n.A,{children:(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center py-10",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded shadow-md w-full max-w-lg",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Settings"}),(0,a.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Your Nightscout Account"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"Name"}),(0,a.jsx)("input",{type:"text",value:t,onChange:e=>s(e.target.value),className:"w-full px-3 py-2 border rounded mb-2",placeholder:"Your name"}),(0,a.jsx)("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"Nightscout URL"}),(0,a.jsx)("input",{type:"text",value:i,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 border rounded mb-2",placeholder:"https://your-nightscout-url"}),(0,a.jsx)("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"API Secret"}),(0,a.jsx)("input",{type:"password",value:d,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 border rounded",placeholder:"API Secret"}),(0,a.jsx)("button",{onClick:y,className:"mt-2 w-full bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600 transition",children:"Save Default"})]}),(0,a.jsx)("hr",{className:"my-6"}),(0,a.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"People You Manage"}),(0,a.jsxs)("form",{onSubmit:w,className:"mb-4",children:[(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"Name"}),(0,a.jsx)("input",{type:"text",value:p,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border rounded",placeholder:"Person's name"})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"Nightscout URL"}),(0,a.jsx)("input",{type:"text",value:g,onChange:e=>N(e.target.value),className:"w-full px-3 py-2 border rounded",placeholder:"https://their-nightscout-url"})]}),(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:"API Secret"}),(0,a.jsx)("input",{type:"password",value:j,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border rounded",placeholder:"API Secret"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"submit",className:"mt-2 flex-1 bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600 transition",children:null!==x?"Update Person":"Add Person"}),null!==x&&(0,a.jsx)("button",{type:"button",onClick:()=>{h(null),b(""),N(""),f("")},className:"mt-2 flex-1 bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400 transition",children:"Cancel"})]})]}),0===u.length?(0,a.jsx)("div",{className:"text-gray-500 italic",children:"No people added yet."}):(0,a.jsxs)("table",{className:"w-full text-sm mb-2",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-2 py-1 border",children:"Name"}),(0,a.jsx)("th",{className:"px-2 py-1 border",children:"Nightscout URL"}),(0,a.jsx)("th",{className:"px-2 py-1 border",children:"API Secret"}),(0,a.jsx)("th",{className:"px-2 py-1 border"})]})}),(0,a.jsx)("tbody",{children:u.map((e,t)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-2 py-1 border",children:e.name}),(0,a.jsx)("td",{className:"px-2 py-1 border",children:e.nightscout_address}),(0,a.jsx)("td",{className:"px-2 py-1 border",children:e.nightscout_api_secret?"••••••••":(0,a.jsx)("span",{className:"text-gray-400",children:"None"})}),(0,a.jsxs)("td",{className:"px-2 py-1 border",children:[(0,a.jsx)("button",{className:"text-blue-600 underline text-xs mr-2",onClick:()=>_(t),children:"Edit"}),(0,a.jsx)("button",{className:"text-red-600 underline text-xs",onClick:()=>S(t),children:"Remove"})]})]},t))})]})]})})}):(0,a.jsx)(n.A,{children:(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"bg-white p-6 rounded shadow-md",children:(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Please log in to view settings."})})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[858,636,593,792],()=>t(8034)),_N_E=e.O()}]);