(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[769],{4752:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/reports",function(){return r(7192)}])},4842:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var a=r(7876),s=r(4232),l=r(8230),o=r.n(l),n=r(1922),d=r(7704),i=r(9149);function c(e){let{children:t}=e,[r,l]=(0,s.useState)(!1),[c,h]=(0,s.useState)(!1),g=(0,s.useRef)(null),{token:u,setToken:x}=(0,s.useContext)(i.AuthContext);return((0,s.useEffect)(()=>{l(!0);let e=e=>{g.current&&!g.current.contains(e.target)&&h(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),r)?(0,a.jsxs)("div",{children:[(0,a.jsx)("nav",{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg fixed top-0 left-0 w-full z-50",children:(0,a.jsxs)("div",{className:"container mx-auto flex justify-between items-center p-4",children:[(0,a.jsxs)("div",{className:"flex space-x-6",children:[(0,a.jsx)(o(),{href:"/",className:"text-lg font-semibold px-3 py-2 rounded hover:bg-white hover:bg-opacity-20 transition duration-300 ease-in-out",children:"Home"}),(0,a.jsx)(o(),{href:"/reports",className:"text-lg font-semibold px-3 py-2 rounded hover:bg-white hover:bg-opacity-20 transition duration-300 ease-in-out",children:"Reports"}),(0,a.jsx)(o(),{href:"/tools",className:"text-lg font-semibold px-3 py-2 rounded hover:bg-white hover:bg-opacity-20 transition duration-300 ease-in-out",children:"Tools"})]}),(0,a.jsx)("div",{className:"relative",ref:g,children:u?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>h(!c),"aria-expanded":c,className:"flex items-center space-x-2 px-3 py-2 rounded hover:bg-purple-200 transition duration-300 ease-in-out",children:(0,a.jsx)(n.A,{className:"h-6 w-6 text-white"})}),c&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white text-gray-800 rounded-lg shadow-lg",role:"menu",children:[(0,a.jsx)("div",{className:"px-4 py-2 border-b",children:(0,a.jsx)("p",{className:"text-sm font-semibold text-gray-700",children:"Logged in"})}),(0,a.jsx)(o(),{href:"/settings",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-purple-200 rounded transition duration-200",role:"menuitem",children:"Settings"}),(0,a.jsx)("button",{onClick:()=>{x(null),localStorage.removeItem("authToken")},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 bg-white hover:bg-purple-200 rounded transition duration-200 focus:outline-none",role:"menuitem",children:(0,a.jsx)("b",{children:"Logout"})})]})]}):(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(o(),{href:"/",className:"flex items-center space-x-2 px-3 py-2 rounded hover:bg-purple-200 transition duration-300 ease-in-out",children:[(0,a.jsx)(d.A,{className:"h-6 w-6 text-white"}),(0,a.jsx)("span",{className:"text-sm font-semibold",children:"Login"})]})})})]})}),(0,a.jsx)("main",{className:"sm:px-0 lg:px-6 pt-8 w-full",children:t})]}):null}},7192:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var a=r(7876),s=r(4232),l=r(6010);r(131);var o=r(1134),n=r(1047);n.t1.register(n.Bs,n.m_,n.s$);let d=e=>isNaN(e)||void 0===e?0:e,i=e=>{let{range:t,setRange:r,loading:n,setLoading:i,nightscoutUrl:c}=e,[h,g]=(0,s.useState)(0),[u,x]=(0,s.useState)(0),[m,b]=(0,s.useState)(0),[p,y]=(0,s.useState)(0),[j,f]=(0,s.useState)(0),[w,N]=(0,s.useState)(0),[v,C]=(0,s.useState)(0),[T,F]=(0,s.useState)(0),[S,D]=(0,s.useState)(0),[U,k]=(0,s.useState)({basal:0,bolus:0}),[A,E]=(0,s.useState)(0),[M,_]=(0,s.useState)(0),[R,H]=(0,s.useState)(0),L=v>0||M>0||R>0||T>0||S>0,I=!isNaN(U.basal)&&U.basal>0||!isNaN(U.bolus)&&U.bolus>0||!isNaN(A)&&A>0;(0,s.useEffect)(()=>{O()},[t,c]);let O=async()=>{try{i(!0);let e=new Date,r=new Date;"today"===t?(r.setUTCHours(0,0,0,0),e.setUTCHours(23,59,59,999)):"yesterday"===t?(r.setUTCDate(e.getUTCDate()-1),r.setUTCHours(0,0,0,0),e.setUTCDate(e.getUTCDate()-1),e.setUTCHours(23,59,59,999)):"1w"===t?r.setUTCDate(e.getUTCDate()-7):"1m"===t?r.setUTCMonth(e.getUTCMonth()-1):"3m"===t&&r.setUTCMonth(e.getUTCMonth()-3);let a="find[dateString][$gte]=".concat(r.toISOString(),"&find[dateString][$lte]=").concat(e.toISOString()),s=await fetch("".concat(c,"/api/v1/entries.json?").concat(a,"&count=10000"));if(!s.ok)throw Error("Failed to fetch blood sugar data: ".concat(s.status));let l=await s.json(),o=l.length,n=l.filter(e=>e.sgv/18>=3.9&&e.sgv/18<=10).length,h=l.filter(e=>e.sgv/18>10).length,u=l.filter(e=>e.sgv/18<3.9).length,m=l.filter(e=>e.sgv/18>=4&&e.sgv/18<=5.5).length,p=l.filter(e=>e.sgv/18>5.5).length,j=l.filter(e=>e.sgv/18<3.8).length;g(o>0?n/o*100:0),x(o>0?h/o*100:0),b(o>0?u/o*100:0),y(o>0?m/o*100:0),f(o>0?p/o*100:0),N(o>0?j/o*100:0);let w="find[created_at][$gte]=".concat(r.toISOString(),"&find[created_at][$lt]=").concat(e.toISOString()),v=await fetch("".concat(c,"/api/v1/treatments.json?count=100000&").concat(w));if(!v.ok)throw Error("Failed to fetch treatment data: ".concat(v.status));let T=await v.json(),S=T.filter((e,t,r)=>{let a=new Date(e.created_at).getTime();return r.some(t=>{let r=new Date(t.created_at).getTime();return"Carb Correction"===e.eventType&&e.carbs===t.carbs&&r>a&&r<=a+6e5})}).reduce((e,t)=>e+(t.carbs||0),0),U=T.filter((e,t,r)=>{let a=new Date(e.created_at).getTime(),s=r.some(t=>{let r=new Date(t.created_at).getTime();return"Carb Correction"===e.eventType&&e.carbs===t.carbs&&r>a&&r<=a+6e5});return"Carb Correction"===e.eventType&&e.carbs>1.9&&!s}).reduce((e,t)=>e+(t.carbs||0),0);C(U),_(S),H(U+S);let A="1w"===t?7:"1m"===t?30:"3m"===t?90:1;F(U/A),D((U+S)/A);let M=async()=>{var e;let t=await fetch("".concat(c,"/api/v1/profile.json"));if(!t.ok)throw Error("Failed to fetch basal profile: ".concat(t.status));let r=null==(e=(await t.json())[0])?void 0:e.store,a=r?Object.keys(r)[0]:null;return a?r[a].basal:[]},R=async(e,t,r)=>{let a=await M(),s=0,l=e.filter(e=>e.eventType.toLowerCase().includes("temp basal")&&e.created_at&&e.duration>0).sort((e,t)=>new Date(e.created_at).getTime()-new Date(t.created_at).getTime());for(let e=t.getTime();e<r.getTime();e+=6e4){let r=l.find(t=>{let r=new Date(t.created_at).getTime(),a=r+60*(t.duration||0)*1e3;return e>=r&&e<a}),o=0;if(r)o=r.rate;else{let r=(e-t.setUTCHours(0,0,0,0))/6e4,s=a.find(e=>{let t=60*parseInt(e.time.split(":")[0])+parseInt(e.time.split(":")[1]);return r>=t});o=s?s.rate:0}s+=o/60}return Math.round(100*s)/100},L=await R(T,r,e),I=T.filter(e=>e.eventType.toLowerCase().includes("bolus")||e.eventType.toLowerCase().includes("smb")).reduce((e,t)=>e+(t.insulin||0),0),O=Math.round(100*I)/100,P=d(L),B=d(O),$=d((P+B)/A);k({basal:P,bolus:B}),E($)}catch(e){console.error("Error fetching statistics:",e)}finally{i(!1)}},P={plugins:{legend:{display:!1}}};return(0,a.jsxs)("div",{className:"bg-white p-6 rounded-md shadow-md",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Statistics"}),(0,a.jsxs)("a",{href:"".concat(c.replace(/\/$/,""),"/report"),target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-2 hover:underline",children:[(0,a.jsx)("img",{src:"nightscout.png",alt:"Nightscout Logo",className:"w-6 h-6"}),(0,a.jsx)("span",{className:"text-blue-600 font-semibold",children:"View Nightscout Report"})]})]}),(0,a.jsxs)("div",{className:"flex justify-center mb-4 space-x-2",children:[(0,a.jsx)("button",{onClick:()=>r("today"),className:"px-4 py-2 rounded-md font-semibold ".concat("today"===t?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"," hover:bg-blue-500 hover:text-white transition"),children:"Today"}),(0,a.jsx)("button",{onClick:()=>r("yesterday"),className:"px-4 py-2 rounded-md font-semibold ".concat("yesterday"===t?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"," hover:bg-blue-500 hover:text-white transition"),children:"Yesterday"}),(0,a.jsx)("button",{onClick:()=>r("1w"),className:"px-4 py-2 rounded-md font-semibold ".concat("1w"===t?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"," hover:bg-blue-500 hover:text-white transition"),children:"1 Week"}),(0,a.jsx)("button",{onClick:()=>r("1m"),className:"px-4 py-2 rounded-md font-semibold ".concat("1m"===t?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"," hover:bg-blue-500 hover:text-white transition"),children:"1 Month"}),(0,a.jsx)("button",{onClick:()=>r("3m"),className:"px-4 py-2 rounded-md font-semibold ".concat("3m"===t?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"," hover:bg-blue-500 hover:text-white transition"),children:"3 Months"})]}),(0,a.jsxs)("div",{className:"overflow-x-auto",children:[(0,a.jsxs)("table",{className:"table-auto w-full text-left border-collapse border border-gray-300",children:[(0,a.jsx)("thead",{children:(0,a.jsx)("tr",{className:"bg-gray-100 col-span-3",children:(0,a.jsx)("th",{className:"px-4 py-2 border border-gray-300",colSpan:4,children:"Time in Range (Internationally Recognised Range)"})})}),(0,a.jsxs)("tbody",{children:[(0,a.jsxs)("tr",{style:{backgroundColor:"#DFF5E1"},children:[(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:"Time in Range"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:"3.9 - 10 mmol/l"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:n?(0,a.jsx)(l.A,{width:100}):"".concat(h.toFixed(1),"%")}),(0,a.jsx)("td",{className:"row-span-3 px-4 py-2 border border-gray-300 text-center align-middle",rowSpan:3,style:{backgroundColor:"#FFFFFF"},children:n?(0,a.jsx)(l.A,{circle:!0,height:100,width:100}):(0,a.jsx)("div",{style:{width:"100px",height:"100px",margin:"0 auto"},children:(0,a.jsx)(o.Fq,{data:{labels:["Time in Range","Time Above Range","Time Below Range"],datasets:[{data:[h,u,m],backgroundColor:["#DFF5E1","#FFE8CC","#FFD6D6"],hoverBackgroundColor:["#C8EACD","#FFD8A8","#FFC2C2"]}]},options:P})})})]}),(0,a.jsxs)("tr",{style:{backgroundColor:"#FFE8CC"},children:[(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:"Time Above Range"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:">10 mmol/l"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:n?(0,a.jsx)(l.A,{width:100}):"".concat(u.toFixed(1),"%")})]}),(0,a.jsxs)("tr",{style:{backgroundColor:"#FFD6D6"},children:[(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:"Time Below Range"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:"<3.9 mmol/l"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:n?(0,a.jsx)(l.A,{width:100}):"".concat(m.toFixed(1),"%")})]})]})]}),(0,a.jsxs)("table",{className:"table-auto w-full text-left border-collapse border border-gray-300",children:[(0,a.jsx)("thead",{children:(0,a.jsx)("tr",{className:"bg-gray-100 col-span-3",children:(0,a.jsx)("th",{className:"px-4 py-2 border border-gray-300",colSpan:4,children:"Time in Range (My Desired Range)"})})}),(0,a.jsxs)("tbody",{children:[(0,a.jsxs)("tr",{style:{backgroundColor:"#DFF5E1"},children:[(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:"Time in Range"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:"3.8 - 5.5 mmol/l"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:n?(0,a.jsx)(l.A,{width:100}):"".concat(p.toFixed(1),"%")}),(0,a.jsx)("td",{className:"row-span-3 px-4 py-2 border border-gray-300 text-center align-middle",rowSpan:3,style:{backgroundColor:"#FFFFFF"},children:n?(0,a.jsx)(l.A,{circle:!0,height:100,width:100}):(0,a.jsx)("div",{style:{width:"100px",height:"100px",margin:"0 auto"},children:(0,a.jsx)(o.Fq,{data:{labels:["Time in Range","Time Above Range","Time Below Range"],datasets:[{data:[p,j,w],backgroundColor:["#DFF5E1","#FFE8CC","#FFD6D6"],hoverBackgroundColor:["#C8EACD","#FFD8A8","#FFC2C2"]}]},options:P})})})]}),(0,a.jsxs)("tr",{style:{backgroundColor:"#FFE8CC"},children:[(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:"Time Above Range"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:">5.5 mmol/l"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:n?(0,a.jsx)(l.A,{width:100}):"".concat(j.toFixed(1),"%")})]}),(0,a.jsxs)("tr",{style:{backgroundColor:"#FFD6D6"},children:[(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:"Time Below Range"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:"<3.8 mmol/l"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:n?(0,a.jsx)(l.A,{width:100}):"".concat(w.toFixed(1),"%")})]})]})]}),L?(0,a.jsxs)("table",{className:"table-auto w-full text-left border-collapse border border-gray-300",children:[(0,a.jsx)("thead",{children:(0,a.jsx)("tr",{className:"bg-gray-100",children:(0,a.jsx)("th",{className:"px-4 py-2 border border-gray-300 col-span-3",colSpan:3,children:"Carbs"})})}),(0,a.jsxs)("tbody",{children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:"Total Carbs Eaten"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:n?(0,a.jsx)(l.A,{width:100}):"".concat(v.toFixed(2)," g")})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:"Protein/Fat Converted to Carbs (Gluconeogenesis)"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:n?(0,a.jsx)(l.A,{width:100}):"".concat(M.toFixed(2),"g")})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:"Total Carb Load"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:n?(0,a.jsx)(l.A,{width:100}):"".concat(R.toFixed(2),"g")})]}),["1w","1m","3m"].includes(t)&&(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:"Average Carbs Eaten Per Day"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:n?(0,a.jsx)(l.A,{width:100}):"".concat(T.toFixed(2)," g/day")})]}),["1w","1m","3m"].includes(t)&&(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:"Average Carb Load Per Day"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:n?(0,a.jsx)(l.A,{width:100}):"".concat(S.toFixed(2)," g/day")})]})]})]}):(0,a.jsx)("div",{className:"my-4 text-center text-gray-500 italic",children:n?(0,a.jsx)(l.A,{width:200}):"No carb data available for this period."}),I?(0,a.jsxs)("table",{className:"table-auto w-full text-left border-collapse border border-gray-300",children:[(0,a.jsx)("thead",{children:(0,a.jsx)("tr",{className:"bg-gray-100",children:(0,a.jsx)("th",{className:"px-4 py-2 border border-gray-300 col-span-3",colSpan:3,children:"Insulin"})})}),(0,a.jsxs)("tbody",{children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:"Total Insulin"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:n?(0,a.jsx)(l.A,{width:150}):"".concat(U.basal+U.bolus," U")})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:"Total Basal"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:n?(0,a.jsx)(l.A,{width:150}):"".concat(U.basal," U")})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:"Total Bolus"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:n?(0,a.jsx)(l.A,{width:150}):"".concat(U.bolus," U")})]}),["1w","1m","3m"].includes(t)&&(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:"Average Daily Insulin"}),(0,a.jsx)("td",{className:"px-4 py-2 border border-gray-300",children:n?(0,a.jsx)(l.A,{width:100}):"".concat(A.toFixed(2)," U/day")})]})]})]}):(0,a.jsx)("div",{className:"my-4 text-center text-gray-500 italic",children:n?(0,a.jsx)(l.A,{width:200}):"No insulin data available for this period."})]})]})};var c=r(2092);let h=e=>{let{range:t,graphData:r}=e,l=(0,s.useRef)(null),o=(0,s.useRef)(null);(0,s.useEffect)(()=>(r.length>0&&d(n()),()=>{o.current&&(o.current.destroy(),o.current=null)}),[r]);let n=()=>{let e={};r.forEach(t=>{let r=new Date(t.dateString),a=5*Math.floor(r.getMinutes()/5),s="".concat(r.getHours().toString().padStart(2,"0"),":").concat(a.toString().padStart(2,"0"));e[s]||(e[s]=[]),e[s].push(t.sgv/18)});let t=[],a=[],s=[],l=[];return Object.keys(e).sort().forEach(r=>{let o=e[r].sort((e,t)=>e-t);if(o.length>0){let e=o[Math.floor(.1*o.length)]||null,n=o[Math.floor(.25*o.length)]||null,d=o[Math.floor(.75*o.length)]||null,i=o[Math.floor(.9*o.length)]||null;t.push(r),a.push({lower:e,upper:i}),s.push({lower:n,upper:d}),l.push(null!==n&&null!==d?(n+d)/2:null)}}),{labels:t,range10:a,range50:s,median:l}},d=e=>{let t=e.labels.map((t,r)=>{var a,s,l,o,n,d,i,c,h;return{time:t,range10Low:null!=(n=null==(a=e.range10[r])?void 0:a.lower)?n:null,range10High:null!=(d=null==(s=e.range10[r])?void 0:s.upper)?d:null,range50Low:null!=(i=null==(l=e.range50[r])?void 0:l.lower)?i:null,range50High:null!=(c=null==(o=e.range50[r])?void 0:o.upper)?c:null,median:null!=(h=e.median[r])?h:null}}),r={container:l.current,data:t,title:{text:"Ambulatory Glucose Profile (AGP)",fontSize:18},series:[{type:"range-area",xKey:"time",yLowKey:"range10Low",yHighKey:"range10High",fillOpacity:.2,fill:"rgba(128, 128, 255, 0.2)",stroke:"rgba(128, 128, 255, 0.2)",tooltip:{enabled:!1}},{type:"range-area",xKey:"time",yLowKey:"range50Low",yHighKey:"range50High",fillOpacity:.4,fill:"rgba(91, 89, 89, 0.4)",stroke:"rgba(91, 89, 89, 0.4)",tooltip:{enabled:!1}},{type:"line",xKey:"time",yKey:"median",stroke:"blue",strokeWidth:2,marker:{enabled:!1},tooltip:{enabled:!0,renderer:e=>void 0!==e.yValue&&null!==e.yValue?"Median: ".concat(e.yValue.toFixed(2)," mmol/L"):"No data available"}}],axes:[{type:"category",position:"bottom",title:{text:"Time of Day"}},{type:"number",position:"left",title:{text:"Blood Sugar (mmol/L)"}}],legend:{position:"bottom"}};o.current&&o.current.destroy(),o.current=c.ui.create(r)};return(0,a.jsx)("div",{className:"bg-white p-4 rounded-md shadow-md",children:(0,a.jsx)("div",{ref:l,style:{height:"400px"}})})};n.t1.register(n.PP,n.kc,n.FN,n.No,n.m_,n.s$,n.dN);let g=e=>{let{range:t,nightscoutUrl:r}=e,[l,n]=(0,s.useState)(null),[d,i]=(0,s.useState)(!1);(0,s.useEffect)(()=>{c()},[t,r]);let c=async()=>{try{i(!0);let e=new Date,a=new Date;"today"===t?(a.setUTCHours(0,0,0,0),e.setUTCHours(23,59,59,999)):"yesterday"===t?(a.setUTCDate(e.getUTCDate()-1),a.setUTCHours(0,0,0,0),e.setUTCDate(e.getUTCDate()-1),e.setUTCHours(23,59,59,999)):"1w"===t?a.setUTCDate(e.getUTCDate()-7):"1m"===t?a.setUTCMonth(e.getUTCMonth()-1):"3m"===t&&a.setUTCMonth(e.getUTCMonth()-3);let s="find[dateString][$gte]=".concat(a.toISOString(),"&find[dateString][$lte]=").concat(e.toISOString()),l=await fetch("".concat(r,"/api/v1/entries.json?").concat(s,"&count=10000"));if(!l.ok)throw Error("Failed to fetch blood sugar data: ".concat(l.status));let o=await l.json(),d={};o.forEach(e=>{let t=new Date(e.dateString).getUTCHours();d[t]||(d[t]=[]),d[t].push(e.sgv/18)});let c=Object.keys(d).map(e=>"".concat(e,":00")),h={p10:[],p25:[],p50:[],p75:[],p90:[]},g=(e,t)=>{if(0===e.length)return 0;let r=[...e].sort((e,t)=>e-t),a=Math.ceil(t/100*r.length)-1;return r[a]||0};c.forEach(e=>{let t=d[parseInt(e.split(":")[0])]||[];h.p10.push(g(t,10)),h.p25.push(g(t,25)),h.p50.push(g(t,50)),h.p75.push(g(t,75)),h.p90.push(g(t,90))}),n({labels:c,datasets:[{label:"10th–90th Percentile",data:h.p90,backgroundColor:"rgba(135, 206, 250, 0.2)",borderColor:"rgba(135, 206, 250, 0.5)",fill:"-1"},{label:"25th–75th Percentile",data:h.p75,backgroundColor:"rgba(144, 238, 144, 0.2)",borderColor:"rgba(144, 238, 144, 0.5)",fill:"-1"},{label:"Median (50th Percentile)",data:h.p50,borderColor:"#4CAF50",borderWidth:2,fill:!1},{label:"25th Percentile",data:h.p25,borderColor:"rgba(144, 238, 144, 0.5)",fill:!1},{label:"10th Percentile",data:h.p10,borderColor:"rgba(135, 206, 250, 0.5)",fill:!1}]})}catch(e){console.error("Error fetching percentile data:",e)}finally{i(!1)}};return(0,a.jsxs)("div",{className:"bg-white p-6 rounded-md shadow-md",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Percentile Report"}),d?(0,a.jsx)("p",{children:"Loading..."}):l?(0,a.jsx)(o.N1,{data:l,options:{responsive:!0,plugins:{legend:{display:!0,position:"top"}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Blood Glucose (mmol/L)"}},x:{title:{display:!0,text:"Time (Hours)"}}}}}):(0,a.jsx)("p",{children:"No data available"})]})};n.t1.register(n.PP,n.kc,n.FN,n.No,n.hE,n.m_,n.s$);let u=e=>{let{range:t,carbsData:r}=e,s={labels:r.map(e=>e.time),datasets:[{label:"today"===t||"yesterday"===t?"Carb Burndown":"Average Carbs Over Time",data:r.map(e=>e.carbs),borderColor:"#4CAF50",backgroundColor:"rgba(76, 175, 80, 0.2)",tension:.4}]},l={responsive:!0,plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:"today"===t||"yesterday"===t?"Carb Burndown":"Average Carbs Over Time"}},scales:{x:{title:{display:!0,text:"Time"}},y:{title:{display:!0,text:"Carbs (g)"},beginAtZero:!0}}};return(0,a.jsx)("div",{className:"bg-white p-6 rounded-md shadow-md",children:(0,a.jsx)(o.N1,{data:s,options:l})})};var x=r(4842);let m=e=>{let{nightscoutUrl:t}=e,[r,l]=(0,s.useState)(null),[o,n]=(0,s.useState)({mmol:null,percentage:null}),[d,i]=(0,s.useState)("3m"),[c,h]=(0,s.useState)(!0),g=t||"https://sharpy-cgm.up.railway.app",u=async(e,t)=>{try{h(!0);let r=new Date,a=new Date;"1d"===e&&a.setDate(r.getDate()-1),"1w"===e&&a.setDate(r.getDate()-7),"1m"===e&&a.setMonth(r.getMonth()-1),"3m"===e&&a.setMonth(r.getMonth()-3);let s="find[dateString][$gte]=".concat(a.toISOString(),"&find[dateString][$lte]=").concat(r.toISOString()),o=await fetch("".concat(t,"/api/v1/entries.json?").concat(s,"&count=100000"));if(!o.ok)throw Error("Failed to fetch glucose data");let d=await o.json();if(0===d.length){l(null),n({mmol:null,percentage:null}),h(!1);return}let i=d.map(e=>e.sgv/18).filter(e=>e>0&&!isNaN(e));if(0===i.length){l(null),n({mmol:null,percentage:null}),h(!1);return}let c=i.reduce((e,t)=>e+t,0)/i.length;l(c);let g=(18*c+46.7)/28.7,u=(g-2.15)*10.929;n({mmol:u.toFixed(1),percentage:g.toFixed(1)}),h(!1)}catch(e){console.error("Error fetching glucose data:",e),l(null),n({mmol:null,percentage:null}),h(!1)}};return(0,s.useEffect)(()=>{u(d,g)},[d,g]),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-md shadow-md",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Estimated HbA1c (GMI)"}),c?(0,a.jsx)("p",{className:"text-center text-gray-500",children:"Loading..."}):null!==o.mmol&&null!==o.percentage?(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("p",{className:"text-lg",children:[(0,a.jsx)("strong",{children:"GMI:"})," ",o.mmol," mmol/mol (",o.percentage,"%)"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Based on mean glucose: ",null==r?void 0:r.toFixed(1)," mmol/L"]})]}):(0,a.jsx)("p",{className:"text-center text-gray-500",children:"No data available for the selected range."}),(0,a.jsxs)("div",{className:"flex justify-center mt-4 space-x-2",children:[(0,a.jsx)("button",{onClick:()=>i("1d"),className:"px-4 py-2 rounded-md font-semibold ".concat("1d"===d?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"," hover:bg-blue-500 hover:text-white transition"),children:"1 Day"}),(0,a.jsx)("button",{onClick:()=>i("1w"),className:"px-4 py-2 rounded-md font-semibold ".concat("1w"===d?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"," hover:bg-blue-500 hover:text-white transition"),children:"1 Week"}),(0,a.jsx)("button",{onClick:()=>i("1m"),className:"px-4 py-2 rounded-md font-semibold ".concat("1m"===d?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"," hover:bg-blue-500 hover:text-white transition"),children:"1 Month"}),(0,a.jsx)("button",{onClick:()=>i("3m"),className:"px-4 py-2 rounded-md font-semibold ".concat("3m"===d?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"," hover:bg-blue-500 hover:text-white transition"),children:"3 Months"})]})]})};var b=r(9149);let p=()=>{let{token:e}=(0,s.useContext)(b.AuthContext),[t,r]=(0,s.useState)("today"),[l,o]=(0,s.useState)(!1),[n,d]=(0,s.useState)([]),[c,p]=(0,s.useState)([]),[y,j]=(0,s.useState)(null),[f,w]=(0,s.useState)([]),[N,v]=(0,s.useState)(0);(0,s.useEffect)(()=>{e&&fetch("/api/user-settings?token=".concat(encodeURIComponent(e))).then(e=>e.json()).then(e=>{e.defaultUser&&j(e.defaultUser),e.people&&w(e.people)})},[e]);let C=[...y?[y]:[],...f],T=C[N]||{nightscout_address:"https://sharpy-cgm.up.railway.app",name:"Default"};(0,s.useEffect)(()=>{(async()=>{if(!(null==T?void 0:T.nightscout_address)||!e)return;let r=await fetch("/api/carbs?range=".concat(t,"&nightscoutUrl=").concat(encodeURIComponent(T.nightscout_address)),{headers:{Authorization:"Bearer ".concat(e)}});p(await r.json())})()},[t,T,e]);let F=async(t,r)=>{try{o(!0);let a=new Date,s=new Date;"today"===t?(s.setUTCHours(0,0,0,0),a.setUTCHours(23,59,59,999)):"yesterday"===t?(s.setUTCDate(a.getUTCDate()-1),s.setUTCHours(0,0,0,0),a.setUTCDate(a.getUTCDate()-1),a.setUTCHours(23,59,59,999)):"1w"===t?s.setUTCDate(a.getUTCDate()-7):"1m"===t?s.setUTCMonth(a.getUTCMonth()-1):"3m"===t&&s.setUTCMonth(a.getUTCMonth()-3);let l="find[dateString][$gte]=".concat(s.toISOString(),"&find[dateString][$lte]=").concat(a.toISOString()),n=await fetch("".concat(r,"/api/v1/entries.json?").concat(l,"&count=10000"),{headers:e?{Authorization:"Bearer ".concat(e)}:{}});if(!n.ok)throw Error("Failed to fetch graph data: ".concat(n.status));let i=await n.json();d(i.reverse())}catch(e){console.error("Error fetching graph data:",e)}finally{o(!1)}};return((0,s.useEffect)(()=>{(null==T?void 0:T.nightscout_address)&&e&&F(t,T.nightscout_address)},[t,T,e]),e)?(0,a.jsx)(x.A,{children:(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 pt-20 sm:px-6 lg:px-8",children:[C.length>0&&(0,a.jsx)("div",{className:"flex gap-2 mb-4 max-w-screen-sm mx-auto",children:C.map((e,t)=>(0,a.jsx)("button",{className:"px-4 py-2 rounded-t ".concat(t===N?"bg-blue-600 text-white":"bg-gray-200"),onClick:()=>v(t),children:e.name},e.name+t))}),(0,a.jsx)("div",{className:"mb-6 w-full max-w-screen-sm mx-auto",children:(0,a.jsx)(i,{range:t,setRange:r,loading:l,setLoading:o,nightscoutUrl:T.nightscout_address})}),(0,a.jsx)("div",{className:"mb-6 w-full max-w-screen-sm mx-auto",children:T&&(0,a.jsx)(m,{nightscoutUrl:T.nightscout_address})}),(0,a.jsx)("div",{className:"mb-6 w-full max-w-screen-sm mx-auto",children:(0,a.jsx)(h,{range:t,graphData:n})}),(0,a.jsx)("div",{className:"mb-6 w-full max-w-screen-sm mx-auto",children:(0,a.jsx)(u,{range:t,carbsData:c})}),(0,a.jsx)("div",{className:"mb-6 w-full max-w-screen-sm mx-auto",children:(0,a.jsx)(g,{range:t,nightscoutUrl:T.nightscout_address})})]})}):(0,a.jsx)(x.A,{children:(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"bg-white p-6 rounded shadow-md",children:(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Please log in to view reports."})})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[697,723,900,858,718,580,636,593,792],()=>t(4752)),_N_E=e.O()}]);