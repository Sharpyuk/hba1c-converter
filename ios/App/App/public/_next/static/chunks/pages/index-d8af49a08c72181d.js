(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{431:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>I});var n=s(7876),l=s(4232),a=s(8230),r=s.n(a),o=s(4842),i=s(1134),d=s(1047),c=s(2585),u=s(9149);d.t1.register(c.A),d.t1.register(d.No,d.FN,d.PP,d.kc,d.m_,d.s$);let x=e=>{let{nightscoutUrl:t}=e,[s,a]=(0,l.useState)(null),[r,o]=(0,l.useState)(null),[d,c]=(0,l.useState)(null),[x,h]=(0,l.useState)(null),[m,b]=(0,l.useState)([]),[p,g]=(0,l.useState)("3h"),[y,f]=(0,l.useState)(!1),[j,w]=(0,l.useState)(!1),[N,v]=(0,l.useState)(null),[S,k]=(0,l.useState)(!1),[C,D]=(0,l.useState)(!1),I=t||"https://sharpy-cgm.up.railway.app",{token:_}=(0,l.useContext)(u.AuthContext),L=async()=>{try{let e=await fetch("".concat(I,"/api/v1/entries.json?count=1"),{headers:_?{Authorization:"Bearer ".concat(_)}:{}});if(!e.ok)throw Error("Failed to fetch blood sugar data");let t=await e.json();t.length>0?(a(t[0].sgv),o(t[0].dateString),c(t[0].direction),h(null)):h("No data available")}catch(e){h(e.message)}},T=async()=>{try{let e=36;"12h"===p&&(e=144),"1d"===p&&(e=288),"3d"===p&&(e=864),"1w"===p&&(e=2016);let t=await fetch("".concat(I,"/api/v1/entries.json?count=").concat(e),{headers:_?{Authorization:"Bearer ".concat(_)}:{}});if(!t.ok)throw Error("Failed to fetch graph data");let s=await t.json();b(s.reverse())}catch(e){b([]),console.error("Error fetching graph data:",e.message)}};(0,l.useEffect)(()=>{L(),T();let e=setInterval(()=>{L(),T()},6e4);return()=>clearInterval(e)},[p,I]);let F=e=>null===e?null:parseFloat((e/18).toFixed(1)),E=F(s),U=async()=>{D(!0),v("Registering hypo...");try{let e=await fetch("/api/nightscout-hypo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({glucose:E})}),t=await e.json();e.ok?v("Hypo registered successfully!"):v(t.error||"Failed to register hypo.")}catch(e){v("Failed to register hypo.")}finally{D(!1),k(!1),setTimeout(()=>w(!1),3e3)}},O={labels:m.map(e=>{let t=new Date(e.dateString);return"3h"===p||"12h"===p||"1d"===p?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString([],{month:"short",day:"numeric"})+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),datasets:[{label:"Blood Sugar (mmol/L)",data:m.map(e=>F(e.sgv)),borderColor:"rgba(75, 192, 192, 1)",backgroundColor:"rgba(75, 192, 192, 0.2)",tension:.4,pointRadius:3*("3h"===p),pointHoverRadius:6*("3h"===p)}]},R={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},annotation:{annotations:{...m.some(e=>null!==F(e.sgv)&&3.8>F(e.sgv))?{lowerRange:{type:"line",yMin:3.8,yMax:3.8,borderColor:"red",borderWidth:2,borderDash:[6,6],label:{content:"3.8 mmol (Low)",enabled:!0,position:"start",backgroundColor:"rgba(255, 0, 0, 0.5)",color:"white"}}}:{},...m.some(e=>null!==F(e.sgv)&&5.5>F(e.sgv))?{upperRange:{type:"line",yMin:5.5,yMax:5.5,borderColor:"orange",borderWidth:2,borderDash:[6,6],label:{content:"5.5 mmol (Target)",enabled:!0,position:"start",backgroundColor:"rgba(255, 165, 0, 0.5)",color:"white"}}}:{}}}},scales:{x:{title:{display:!0,text:"Time"}},y:{title:{display:!0,text:"Blood Sugar (mmol/L)"},beginAtZero:!1,min:y?void 0:3,max:y?void 0:15}}};return(0,n.jsxs)("div",{className:"".concat((e=>null===e?"bg-gray-500":e>=4&&e<=5.5?"bg-green-500":e>5.5&&e<=6.5||e>=3.7&&e<4?"bg-orange-500":e<3.7||e>6.5?"bg-red-500":"bg-gray-500")(E)," text-white p-4 text-center w-full relative"),children:[(0,n.jsx)("button",{className:"absolute top-10 left-10 z-20 bg-yellow-400 hover:bg-yellow-300 rounded-full shadow-2xl shadow-black p-2",style:{width:48,height:48,fontSize:32,lineHeight:"32px"},title:"Register Hypo",onClick:()=>{w(!0),v(null),null!==E&&E<4.3?U():(k(!0),setTimeout(()=>{w(!1),k(!1),v(null)},1e4))},children:"⭐"}),j&&(0,n.jsxs)("div",{className:"absolute left-0 right-0 top-0 mx-auto mt-2 bg-yellow-100 text-yellow-900 rounded shadow-lg px-6 py-4 z-30 max-w-md w-full flex flex-col items-center",children:[N&&(0,n.jsx)("div",{className:"font-semibold mb-2",children:N}),S&&(0,n.jsxs)("div",{className:"flex flex-col items-center",children:[(0,n.jsx)("div",{className:"mb-2 font-semibold",children:"Current BG is not low. Are you sure you want to register a hypo?"}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded",onClick:()=>{k(!1),U()},disabled:C,children:"Yes"}),(0,n.jsx)("button",{className:"bg-gray-400 text-white px-4 py-2 rounded",onClick:()=>{w(!1),k(!1),v(null)},disabled:C,children:"No"})]})]})]}),x?(0,n.jsxs)("p",{children:["Error: ",x]}):null!==s?(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"text-lg font-bold",children:["Current Blood Sugar: ",(0,n.jsx)("br",{})," ",(0,n.jsxs)("span",{className:"text-4xl",children:[E," mmol/L ",(e=>{switch(e){case"DoubleUp":return"⬆⬆";case"SingleUp":return"⬆";case"FortyFiveUp":return"↗";case"Flat":return"→";case"FortyFiveDown":return"↘";case"SingleDown":return"⬇";case"DoubleDown":return"⬇⬇";default:return""}})(d)]})]}),(0,n.jsxs)("p",{className:"text-sm",children:["Last updated: ",new Date(r||"").toLocaleString()]}),(0,n.jsx)("div",{className:"mt-4 bg-white p-4 rounded-md",style:{height:"200px",width:"100%"},children:(0,n.jsx)(i.N1,{data:O,options:R})}),(0,n.jsxs)("div",{className:"flex justify-center mt-6 space-x-4",children:[(0,n.jsx)("button",{onClick:()=>g("3h"),className:"px-4 py-2 rounded-md font-semibold ".concat("3h"===p?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"," hover:bg-blue-500 hover:text-white transition"),children:"3 Hours"}),(0,n.jsx)("button",{onClick:()=>g("12h"),className:"px-4 py-2 rounded-md font-semibold ".concat("12h"===p?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"," hover:bg-blue-500 hover:text-white transition"),children:"12 Hours"}),(0,n.jsx)("button",{onClick:()=>g("1d"),className:"px-4 py-2 rounded-md font-semibold ".concat("1d"===p?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"," hover:bg-blue-500 hover:text-white transition"),children:"1 Day"}),(0,n.jsx)("button",{onClick:()=>g("3d"),className:"px-4 py-2 rounded-md font-semibold ".concat("3d"===p?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"," hover:bg-blue-500 hover:text-white transition"),children:"3 Days"}),(0,n.jsx)("button",{onClick:()=>g("1w"),className:"px-4 py-2 rounded-md font-semibold ".concat("1w"===p?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"," hover:bg-blue-500 hover:text-white transition"),children:"1 Week"})]}),(0,n.jsx)("div",{className:"mt-4",children:(0,n.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:y,onChange:e=>f(e.target.checked),className:"form-checkbox h-5 w-5 text-blue-600"}),(0,n.jsx)("span",{className:"text-sm",children:"Zoom"})]})})]}):(0,n.jsx)("p",{children:"Loading..."})]})},h=[{label:"Today",value:"today"},{label:"1 Week",value:"1w"},{label:"1 Month",value:"1m"},{label:"3 Months",value:"3m"}],m=e=>{let{nightscoutUrl:t,personId:s}=e,[a,r]=(0,l.useState)([]),[o,i]=(0,l.useState)(!1),[d,c]=(0,l.useState)("today"),[u,x]=(0,l.useState)(null),[m,b]=(0,l.useState)(""),[p,g]=(0,l.useState)(""),[y,f]=(0,l.useState)(null),j=t||"https://sharpy-cgm.up.railway.app",w=()=>{i(!0);let e=new Date,t=new Date;"today"===d?t.setHours(0,0,0,0):"1w"===d?t.setDate(e.getDate()-7):"1m"===d?t.setMonth(e.getMonth()-1):"3m"===d&&t.setMonth(e.getMonth()-3),fetch("".concat(j,"/api/v1/treatments.json?find[eventType]=Carb Correction&find[enteredBy]=hba1c-converter&find[created_at][$gte]=").concat(t.toISOString(),"&find[created_at][$lte]=").concat(e.toISOString(),"&count=1000")).then(e=>e.json()).then(e=>{r(e),i(!1)}).catch(()=>{r([]),i(!1)})};(0,l.useEffect)(()=>{w()},[j,d]);let N=async e=>{f(e),await fetch("/api/nightscout-hypo?id=".concat(e,"&personId=").concat(encodeURIComponent(s||"")),{method:"DELETE"}),f(null),w()},v=e=>{x(e),b(e.carbs.toString()),g(e.notes||"")},S=async e=>{e.preventDefault(),u&&(await fetch("/api/nightscout-hypo",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:u._id,carbs:parseFloat(m),notes:p,personId:s||""})}),x(null),w())};return(0,n.jsxs)("div",{className:"bg-white p-4 rounded-md shadow-md mt-6",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Hypo Treatments"}),(0,n.jsx)("div",{className:"flex space-x-2 mb-4",children:h.map(e=>(0,n.jsx)("button",{onClick:()=>c(e.value),className:"px-3 py-1 rounded ".concat(d===e.value?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"),children:e.label},e.value))}),o?(0,n.jsx)("div",{children:"Loading..."}):0===a.length?(0,n.jsx)("div",{className:"text-gray-500 italic",children:"No hypo treatments found for this period."}):(0,n.jsxs)("table",{className:"w-full table-auto text-sm",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-2 py-1 border",children:"Date/Time"}),(0,n.jsx)("th",{className:"px-2 py-1 border",children:"Carbs (g)"}),(0,n.jsx)("th",{className:"px-2 py-1 border",children:"Blood Glucose (mmol/L)"}),(0,n.jsx)("th",{className:"px-2 py-1 border"})]})}),(0,n.jsx)("tbody",{children:a.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"px-2 py-1 border",children:new Date(e.created_at).toLocaleString()}),(0,n.jsx)("td",{className:"px-2 py-1 border",children:e.carbs}),(0,n.jsx)("td",{className:"px-2 py-1 border",children:"number"==typeof e.glucose?e.glucose.toFixed(1):e.notes?e.notes:""}),(0,n.jsxs)("td",{className:"px-2 py-1 border text-center",children:[(0,n.jsx)("button",{className:"text-xs text-white mr-2",onClick:()=>v(e),children:"Edit"}),(0,n.jsx)("button",{className:"text-xs text-white",onClick:()=>N(e._id),disabled:y===e._id,children:y===e._id?"Deleting...":"X"})]})]},e._id))})]}),u&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:(0,n.jsxs)("form",{onSubmit:S,className:"bg-white p-6 rounded shadow-md w-full max-w-xs",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Edit Hypo Treatment"}),(0,n.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"Carbs (g)"}),(0,n.jsx)("input",{type:"number",step:"0.1",value:m,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border rounded mb-4",required:!0}),(0,n.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"Notes"}),(0,n.jsx)("input",{type:"text",value:p,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border rounded mb-4"}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded flex-1",children:"Save"}),(0,n.jsx)("button",{type:"button",className:"bg-gray-300 text-gray-800 px-4 py-2 rounded flex-1",onClick:()=>x(null),children:"Cancel"})]})]})})]})};var b=s(252),p=s(4274),g=s(4758),y=s(2333),f=s(9064),j=s(5607),w=s(7566),N=s(4457);function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,s=0,n=Date.now();return e.forEach(e=>{if(e.insulin&&e.created_at){let l=(n-new Date(e.created_at).getTime())/6e4;l<60*t&&(s+=e.insulin*function(e,t){let s=e/60;return s<0?1:s>=t?0:s<=t/2?1-2*s/t:2*(1-s/t)*(1-s/t)}(l,t))}}),Math.max(0,s)}function S(e){let t=0,s=Date.now();return e.forEach(e=>{if(e.carbs&&e.created_at){let n=(s-new Date(e.created_at).getTime())/6e4;n<120&&(t+=e.carbs*(1-n/120))}}),Math.max(0,t)}let k=e=>{let{nightscoutUrl:t}=e,[s,a]=(0,l.useState)(null),[r,o]=(0,l.useState)(null),[i,d]=(0,l.useState)([]),[c,u]=(0,l.useState)(()=>{let e=new Date;return e.setHours(0,0,0,0),e}),[x,h]=(0,l.useState)(null),[m,k]=(0,l.useState)(null),[C,D]=(0,l.useState)(""),[I,_]=(0,l.useState)(""),[L,T]=(0,l.useState)(""),[F,E]=(0,l.useState)(""),[U,O]=(0,l.useState)(null),R=i.reduce((e,t)=>e+("number"==typeof t.insulin?t.insulin:0),0),H=i.reduce((e,t)=>e+("number"==typeof t.carbs?t.carbs:0),0),A=t||"https://sharpy-cgm.up.railway.app",M=e=>{var t,s,n;k(e),D((null==(t=e.carbs)?void 0:t.toString())||""),_((null==(s=e.insulin)?void 0:s.toString())||""),T((null==(n=e.glucose)?void 0:n.toString())||""),E(e.notes||"")},B=async e=>{if(e.preventDefault(),!m)return;await fetch("/api/nightscout-hypo",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:m._id,carbs:parseFloat(C),insulin:parseFloat(I),glucose:parseFloat(L),notes:F})}),k(null),h(null);let t=new Date(c),s=new Date(c);s.setHours(23,59,59,999),fetch("".concat(A,"/api/v1/treatments.json?find[created_at][$gte]=").concat(t.toISOString(),"&find[created_at][$lte]=").concat(s.toISOString(),"&count=1000")).then(e=>e.json()).then(e=>{d(e),a(v(e)),o(S(e))})},z=async e=>{O(e),await fetch("/api/nightscout-hypo?id=".concat(e),{method:"DELETE"}),O(null),h(null);let t=new Date(c),s=new Date(c);s.setHours(23,59,59,999),fetch("".concat(A,"/api/v1/treatments.json?find[created_at][$gte]=").concat(t.toISOString(),"&find[created_at][$lte]=").concat(s.toISOString(),"&count=1000")).then(e=>e.json()).then(e=>{d(e),a(v(e)),o(S(e))})};(0,l.useEffect)(()=>{let e=new Date(c),t=new Date(c);t.setHours(23,59,59,999),fetch("".concat(A,"/api/v1/treatments.json?find[created_at][$gte]=").concat(e.toISOString(),"&find[created_at][$lte]=").concat(t.toISOString(),"&count=1000")).then(e=>e.json()).then(e=>{d(e),a(v(e)),o(S(e))})},[A,c]);let P=function(e,t){let s=Array.from({length:24},(e,t)=>({hour:"".concat(t,":00"),carbs:0,insulin:0}));return e.forEach(e=>{if(e.created_at){let n=new Date(e.created_at);if(n.getFullYear()===t.getFullYear()&&n.getMonth()===t.getMonth()&&n.getDate()===t.getDate()){let t=n.getHours();e.carbs&&(s[t].carbs+=e.carbs),e.insulin&&(s[t].insulin+=e.insulin)}}}),s}(i,c),G=null!==x?i.filter(e=>{let t=new Date(e.created_at);return t.getFullYear()===c.getFullYear()&&t.getMonth()===c.getMonth()&&t.getDate()===c.getDate()&&t.getHours()===x}):[];return(0,n.jsxs)("div",{className:"bg-blue-50 p-4 rounded-xl shadow-md mt-6 max-w-screen-sm mx-auto",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Insulin & Carbs"}),(0,n.jsxs)("div",{className:"flex justify-center gap-4 mb-4",children:[(0,n.jsxs)("div",{className:"bg-white shadow rounded-lg px-6 py-3 flex flex-col items-center min-w-[110px]",children:[(0,n.jsx)("span",{className:"text-xs text-gray-500 font-medium mb-1",children:"IOB"}),(0,n.jsxs)("span",{className:"text-lg font-bold text-blue-700",children:[null!==s?s.toFixed(2):"--",(0,n.jsx)("span",{className:"text-base font-normal text-gray-500",children:"U"})]})]}),(0,n.jsxs)("div",{className:"bg-white shadow rounded-lg px-6 py-3 flex flex-col items-center min-w-[110px]",children:[(0,n.jsx)("span",{className:"text-xs text-gray-500 font-medium mb-1",children:"COB"}),(0,n.jsxs)("span",{className:"text-lg font-bold text-yellow-700",children:[null!==r?r.toFixed(1):"--",(0,n.jsx)("span",{className:"text-base font-normal text-gray-500",children:"g"})]})]})]}),(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow py-6 px-2 transition-all duration-300",style:{width:"100%",minHeight:340},children:[(0,n.jsxs)("div",{className:"flex items-center justify-center gap-4 mb-2",children:[(0,n.jsx)("button",{className:"w-12 h-12 flex items-center justify-center rounded-full bg-gray-200 text-2xl shadow transition active:bg-gray-300","aria-label":"Previous day",onClick:()=>u(e=>{let t=new Date(e);return t.setDate(t.getDate()-1),h(null),t}),children:(0,n.jsx)("svg",{width:"32",height:"32",fill:"none",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{d:"M15 19l-7-7 7-7",stroke:"#374151",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,n.jsx)("span",{className:"font-semibold text-base",children:function(e){let t=new Date;t.setHours(0,0,0,0);let s=Math.round((e.getTime()-t.getTime())/864e5);return 0===s?"Today":-1===s?"Yesterday":1===s?"Tomorrow":e.toLocaleDateString(void 0,{weekday:"short",day:"2-digit",month:"short"})}(c)}),(0,n.jsx)("button",{className:"w-12 h-12 flex items-center justify-center rounded-full bg-gray-200 text-2xl shadow transition active:bg-gray-300","aria-label":"Next day",onClick:()=>u(e=>{let t=new Date(e);return t.setDate(t.getDate()+1),h(null),t}),children:(0,n.jsx)("svg",{width:"32",height:"32",fill:"none",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{d:"M9 5l7 7-7 7",stroke:"#374151",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),(0,n.jsx)("div",{style:{width:"100%",height:160},children:(0,n.jsx)(b.u,{children:(0,n.jsxs)(p.E,{data:P,margin:{top:10,right:10,left:0,bottom:0},onClick:e=>{e&&e.activeLabel&&h(parseInt(e.activeLabel.split(":")[0],10))},children:[(0,n.jsx)(g.d,{stroke:"#e5e7eb",strokeWidth:.5,vertical:!1}),(0,n.jsx)(y.W,{dataKey:"hour",fontSize:10}),(0,n.jsx)(f.h,{yAxisId:"left",fontSize:10,axisLine:!0,tickLine:!0,width:25,label:{value:"Carbs (g)",angle:-90,position:"insideLeft",fontSize:10}}),(0,n.jsx)(f.h,{yAxisId:"right",orientation:"right",fontSize:10,axisLine:!0,tickLine:!0,width:25,domain:[0,5],label:{value:"Insulin (U)",angle:90,position:"insideRight",fontSize:10}}),(0,n.jsx)(j.m,{content:(0,n.jsx)(e=>{let{active:t,payload:s,label:l}=e;if(t&&s&&s.length){var a,r;let e=null==(a=s.find(e=>"carbs"===e.dataKey))?void 0:a.value,t=null==(r=s.find(e=>"insulin"===e.dataKey))?void 0:r.value;return(0,n.jsxs)("div",{className:"bg-white border rounded shadow p-2 text-xs",children:[(0,n.jsx)("div",{children:(0,n.jsx)("strong",{children:l})}),(0,n.jsxs)("div",{children:["Carbs: ",null!=e?e:0," g"]}),(0,n.jsxs)("div",{children:["Insulin: ",void 0!==t?Number(t).toFixed(2):"0.00"," U"]})]})}return null},{})}),(0,n.jsx)(w.s,{}),(0,n.jsx)(N.y,{yAxisId:"left",dataKey:"carbs",fill:"#fbbf24",name:"Carbs (g)",radius:[4,4,0,0]}),(0,n.jsx)(N.y,{yAxisId:"right",dataKey:"insulin",fill:"#3b82f6",name:"Insulin (U)",radius:[4,4,0,0]})]})})}),m&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:(0,n.jsxs)("form",{onSubmit:B,className:"bg-white p-6 rounded shadow-md w-full max-w-xs",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Edit Treatment"}),(0,n.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"Carbs (g)"}),(0,n.jsx)("input",{type:"number",step:"0.1",value:C,onChange:e=>D(e.target.value),className:"w-full px-3 py-2 border rounded mb-4"}),(0,n.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"Insulin (U)"}),(0,n.jsx)("input",{type:"number",step:"0.1",value:I,onChange:e=>_(e.target.value),className:"w-full px-3 py-2 border rounded mb-4"}),(0,n.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"Blood Glucose (mmol/L)"}),(0,n.jsx)("input",{type:"number",step:"0.1",value:L,onChange:e=>T(e.target.value),className:"w-full px-3 py-2 border rounded mb-4"}),(0,n.jsx)("label",{className:"block mb-2 text-sm font-medium",children:"Notes"}),(0,n.jsx)("input",{type:"text",value:F,onChange:e=>E(e.target.value),className:"w-full px-3 py-2 border rounded mb-4"}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded flex-1",children:"Save"}),(0,n.jsx)("button",{type:"button",className:"bg-gray-300 text-gray-800 px-4 py-2 rounded flex-1",onClick:()=>k(null),children:"Cancel"})]})]})}),null!==x&&(0,n.jsxs)("div",{className:"mt-4 bg-gray-50 rounded p-3 border border-gray-200",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsxs)("span",{className:"font-semibold",children:["Treatments for ",x,":00"]}),(0,n.jsx)("button",{className:"text-xs text-white bg-blue-600 px-2 py-1 rounded transition hover:bg-blue-700",onClick:()=>h(null),children:"Hide"})]}),0===G.filter(e=>e.carbs||e.insulin).length?(0,n.jsx)("div",{className:"text-gray-500 italic",children:"No treatments for this hour."}):(0,n.jsxs)("table",{className:"w-full text-sm border border-blue-200 rounded overflow-hidden",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-blue-600 text-white",children:[(0,n.jsx)("th",{className:"px-2 py-1 border-blue-200 text-center font-semibold",children:"Time"}),(0,n.jsx)("th",{className:"px-2 py-1 border-blue-200 text-center font-semibold",children:"Carbs (g)"}),(0,n.jsx)("th",{className:"px-2 py-1 border-blue-200 text-center font-semibold",children:"Insulin (U)"}),(0,n.jsx)("th",{className:"px-2 py-1 border-blue-200 text-center font-semibold",children:"Blood Glucose (mmol/L)"}),(0,n.jsx)("th",{})]})}),(0,n.jsx)("tbody",{children:[...G].reverse().filter(e=>e.carbs||e.insulin).map((e,t)=>{var s,a;let r,o=function(e){if(!e)return null;try{let t=JSON.parse(e);if("object"==typeof t&&null!==t)return t}catch(e){}return null}(e.notes),i=o&&Object.keys(o).length>0||e.notes&&""!==e.notes.trim();"number"==typeof e.glucose?r=e.glucose:o&&"number"==typeof o.bloodGlucoseInput&&(r=o.bloodGlucoseInput);let d=function(e){return"Carb Correction"===e.eventType&&"hba1c-converter"===e.enteredBy||e.notes&&"string"==typeof e.notes&&e.notes.toLowerCase().includes("hypo")}(e);return(0,n.jsxs)(l.Fragment,{children:[(0,n.jsxs)("tr",{className:"even:bg-blue-50".concat(d?" bg-yellow-100":""),children:[(0,n.jsx)("td",{className:"px-2 py-1 border-blue-100 text-center font-mono",children:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,n.jsx)("td",{className:"px-2 py-1 border-blue-100 text-center font-mono",children:null!=(s=e.carbs)?s:""}),(0,n.jsx)("td",{className:"px-2 py-1 border-blue-100 text-center font-mono",children:null!=(a=e.insulin)?a:""}),(0,n.jsx)("td",{className:"px-2 py-1 border-blue-100 text-center font-mono",children:"number"==typeof r?r.toFixed(1):""}),(0,n.jsxs)("td",{className:"px-2 py-1 border-blue-100 text-center",children:[(0,n.jsx)("button",{className:"text-xs text-white mr-2",onClick:()=>M(e),children:"Edit"}),(0,n.jsx)("button",{className:"text-xs text-white",onClick:()=>z(e._id),children:"X"})]})]}),i&&(0,n.jsx)("tr",{children:(0,n.jsxs)("td",{className:"px-2 py-1 border-blue-100 bg-blue-50",colSpan:4,children:[d&&(0,n.jsx)("span",{className:"inline-block bg-yellow-200 text-yellow-900 px-2 py-1 rounded mr-2 font-semibold text-xs",children:"Hypo Treatment"}),o&&"Insulet Omnipod\xae 5 System"===o.pumpName?function(e){return e?(0,n.jsx)("div",{className:"flex justify-center my-2",children:(0,n.jsx)("table",{className:"bg-white border border-blue-200 rounded shadow text-xs min-w-[320px]",children:(0,n.jsx)("tbody",{children:[{label:"Insulin Delivered",key:"insulinDelivered",unit:"U"},{label:"Carbs Input",key:"carbsInput",unit:"g"},{label:"Insulin On Board",key:"insulinOnBoard",unit:"U"},{label:"Total Insulin Recommendation",key:"totalInsulinRecommendation",unit:"U"},{label:"Blood Glucose Input",key:"bloodGlucoseInput",unit:"mg/dL"},{label:"Insulin Programmed",key:"insulinProgrammed",unit:"U"},{label:"Insulin Recommendation For Carbs",key:"insulinRecommendationForCarbs",unit:"U"},{label:"Insulin Recommendation For Correction",key:"insulinRecommendationForCorrection",unit:"U"},{label:"Insulin Reduction",key:"insulinReduction",unit:"U"},{label:"Override",key:"override",unit:""}].map(t=>{let{label:s,key:l,unit:a}=t,r=e[l];return"bloodGlucoseInput"===l&&null==r||"override"===l&&null==r?null:(0,n.jsxs)("tr",{className:"even:bg-blue-50",children:[(0,n.jsx)("td",{className:"px-3 py-1 border-b border-blue-100 font-medium text-right whitespace-nowrap text-blue-900",children:s}),(0,n.jsx)("td",{className:"px-3 py-1 border-b border-blue-100 text-blue-800 text-right",children:null!=r&&""!==r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"font-mono",children:r}),a&&(0,n.jsx)("span",{className:"ml-1 text-xs text-blue-500",children:a})]}):(0,n.jsx)("span",{className:"text-gray-400",children:"—"})})]},l)})})})}):null}(o):o?(0,n.jsx)("pre",{className:"whitespace-pre-wrap text-xs bg-gray-100 p-1 rounded",children:JSON.stringify(o,null,2)}):e.notes]})})]},e._id||t)})})]})]}),(0,n.jsxs)("div",{className:"flex justify-center gap-8 mt-6",children:[(0,n.jsxs)("div",{className:"bg-gray-100 rounded-lg shadow px-4 py-2 flex flex-col items-center min-w-[110px]",children:[(0,n.jsx)("span",{className:"text-xs text-gray-500 font-medium mb-1",children:"TDD"}),(0,n.jsxs)("span",{className:"text-lg font-bold text-blue-700",children:[R.toFixed(2),(0,n.jsx)("span",{className:"text-base font-normal text-gray-500",children:"U"})]})]}),(0,n.jsxs)("div",{className:"bg-gray-100 rounded-lg shadow px-4 py-2 flex flex-col items-center min-w-[110px]",children:[(0,n.jsx)("span",{className:"text-xs text-gray-500 font-medium mb-1",children:"Total Carbs"}),(0,n.jsxs)("span",{className:"text-lg font-bold text-yellow-700",children:[H.toFixed(1),(0,n.jsx)("span",{className:"text-base font-normal text-gray-500",children:"g"})]})]})]})]})]})};var C=s(923);let D=()=>{let{setToken:e}=(0,l.useContext)(u.AuthContext),t=async()=>{await C.P.open({url:"".concat("https://craigsharpe.me.uk","/api/auth/signin/google")})};return(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Login"}),(0,n.jsx)("button",{className:"bg-blue-600 text-white px-6 py-3 rounded-lg shadow",onClick:t,children:"Login with Google"})]})},I=()=>{let{token:e}=(0,l.useContext)(u.AuthContext),[t,s]=(0,l.useState)(null),[a,i]=(0,l.useState)([]),[d,c]=(0,l.useState)(0);(0,l.useEffect)(()=>{e&&fetch("/api/user-settings?token=".concat(encodeURIComponent(e))).then(e=>e.json()).then(e=>{e.defaultUser&&s(e.defaultUser),e.people&&i(e.people)})},[e]);let h=[...t?[t]:[],...a],b=h[d];return e?(0,n.jsx)(o.A,{children:(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50 pt-16 sm:px-6 lg:px-8 w-full",children:[(0,n.jsxs)("div",{className:"mb-6 w-full max-w-screen-sm mx-auto",children:[h.length>0&&(0,n.jsx)("div",{className:"flex gap-2 mb-4",children:h.map((e,t)=>(0,n.jsx)("button",{className:"px-4 py-2 rounded-t ".concat(t===d?"bg-blue-600 text-white":"bg-gray-200"),onClick:()=>c(t),children:e.name},e.name+t))}),b&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(x,{nightscoutUrl:b.nightscout_address}),(0,n.jsx)(k,{nightscoutUrl:b.nightscout_address})]})]}),(0,n.jsx)("div",{className:"mb-6 w-full max-w-screen-sm mx-auto",children:b&&(0,n.jsx)(m,{personId:b.name,nightscoutUrl:b.nightscout_address})}),(0,n.jsx)("div",{className:"text-center mt-6",children:(0,n.jsx)(r(),{href:"/reports",className:"text-blue-500 underline",children:"View Reports"})})]})}):(0,n.jsx)(D,{})}},4842:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});var n=s(7876),l=s(4232),a=s(8230),r=s.n(a),o=s(1922),i=s(7704),d=s(9149);function c(e){let{children:t}=e,[s,a]=(0,l.useState)(!1),[c,u]=(0,l.useState)(!1),x=(0,l.useRef)(null),{token:h,setToken:m}=(0,l.useContext)(d.AuthContext);return((0,l.useEffect)(()=>{a(!0);let e=e=>{x.current&&!x.current.contains(e.target)&&u(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),s)?(0,n.jsxs)("div",{children:[(0,n.jsx)("nav",{className:"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg fixed top-0 left-0 w-full z-50",children:(0,n.jsxs)("div",{className:"container mx-auto flex justify-between items-center p-4",children:[(0,n.jsxs)("div",{className:"flex space-x-6",children:[(0,n.jsx)(r(),{href:"/",className:"text-lg font-semibold px-3 py-2 rounded hover:bg-white hover:bg-opacity-20 transition duration-300 ease-in-out",children:"Home"}),(0,n.jsx)(r(),{href:"/reports",className:"text-lg font-semibold px-3 py-2 rounded hover:bg-white hover:bg-opacity-20 transition duration-300 ease-in-out",children:"Reports"}),(0,n.jsx)(r(),{href:"/tools",className:"text-lg font-semibold px-3 py-2 rounded hover:bg-white hover:bg-opacity-20 transition duration-300 ease-in-out",children:"Tools"})]}),(0,n.jsx)("div",{className:"relative",ref:x,children:h?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:()=>u(!c),"aria-expanded":c,className:"flex items-center space-x-2 px-3 py-2 rounded hover:bg-purple-200 transition duration-300 ease-in-out",children:(0,n.jsx)(o.A,{className:"h-6 w-6 text-white"})}),c&&(0,n.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white text-gray-800 rounded-lg shadow-lg",role:"menu",children:[(0,n.jsx)("div",{className:"px-4 py-2 border-b",children:(0,n.jsx)("p",{className:"text-sm font-semibold text-gray-700",children:"Logged in"})}),(0,n.jsx)(r(),{href:"/settings",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-purple-200 rounded transition duration-200",role:"menuitem",children:"Settings"}),(0,n.jsx)("button",{onClick:()=>{m(null),localStorage.removeItem("authToken")},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 bg-white hover:bg-purple-200 rounded transition duration-200 focus:outline-none",role:"menuitem",children:(0,n.jsx)("b",{children:"Logout"})})]})]}):(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(r(),{href:"/",className:"flex items-center space-x-2 px-3 py-2 rounded hover:bg-purple-200 transition duration-300 ease-in-out",children:[(0,n.jsx)(i.A,{className:"h-6 w-6 text-white"}),(0,n.jsx)("span",{className:"text-sm font-semibold",children:"Login"})]})})})]})}),(0,n.jsx)("main",{className:"sm:px-0 lg:px-6 pt-8 w-full",children:t})]}):null}},6760:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(431)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[697,858,718,898,636,593,792],()=>t(6760)),_N_E=e.O()}]);